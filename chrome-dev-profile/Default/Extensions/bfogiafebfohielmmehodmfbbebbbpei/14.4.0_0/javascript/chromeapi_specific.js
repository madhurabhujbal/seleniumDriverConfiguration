"undefined"!=typeof browser&&browser.browserAction&&(chrome=browser),chrome.runtime.onInstalled&&chrome.runtime.onInstalled.addListener(function(e){getTosDates(),chrome.tabs.query({url:["https://keepersecurity.com/vault*","https://*.keepersecurity.com/vault*","https://keepersecurity.eu/vault*","https://*.keepersecurity.eu/vault*","http://localhost:8000/vault*"]},function(e){if(e.length>0){var t=function(e,t){return new Promise(function(n,r){chrome.tabs.executeScript(t.id,{file:e},n)})};e.forEach(function(e){t("content_scripts/messaging.js",e).then(function(){return t("content_scripts/vault.js",e)}).then(()=>{initiateConnectionToVault(e)})})}})}),chrome.runtime.onStartup&&chrome.runtime.onStartup.addListener(function(){chrome.browserAction.setIcon({path:{19:"19-inactive.png",38:"38-inactive.png"}})}),chrome.runtime.onConnectExternal&&chrome.runtime.onConnectExternal.addListener(function(e){var t=[DATA_VAULT_URL_US,DATA_VAULT_URL_EU].some(function(t){return e.sender.tab.url.includes("#")?e.sender.tab.url.substring(0,e.sender.tab.url.indexOf("#"))==t:e.sender.tab.url==t});e.onDisconnect.addListener(function(e){delete bg.vault_port_by_tab[e.sender.tab.id]}),e.onMessage.addListener(function(t){VaultMessaging.handleVaultMessage(t,e.sender.tab.id,e.postMessage)}),t?(bg.vault_port_by_tab[e.sender.tab.id]=e,VaultMessaging.sendMessageToVault({cmd:"handshake"},e.sender.tab.id)):(logger({data:"A rogue port is trying to open: "+e,whichMessage:{vaultMessages:!0},consoleFunction:console.error}),e.disconnect())});