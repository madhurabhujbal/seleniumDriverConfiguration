var safariAPI="undefined"!=typeof safari&&void 0!==safari.extension&&"undefined"!==safari.self,isFirefox="undefined"!=typeof InstallTrigger,isEdge=!!window.StyleMedia,inFrame=window.location!==window.parent.location;isEdge&&(chrome=browser);var messageCallbacks=new function(){var e={};this.register=(s=>{const a="k-"+Math.random().toString(36).substr(2);return e[a]=s,a}),this.invoke=((s,...a)=>{var n=e[s];n&&(delete e[s],n(...a))})};function sendMessage(e,s,a){var n=JSON.parse(JSON.stringify({name:e,params:s}));if(safariAPI)a&&(n.callbackId=messageCallbacks.register(a)),safari.extension.dispatchMessage("keeper_safari_message",n);else if("undefined"==typeof chrome||isFirefox)isFirefox?Promise.resolve().then(()=>browser.runtime.sendMessage(n)).then(e=>{a&&a(e)}).catch(e=>{}):browser.runtime.sendMessage(n,function(e){browser.runtime.lastError,a&&a(e)});else try{chrome.runtime.sendMessage(n,function(e){chrome.runtime.lastError,a&&a(e)})}catch(e){}"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.lastError}function addMessageListener(e){safariAPI?safari.self.addEventListener("message",function(s){var a=s.message;e(a)}):"undefined"!=typeof chrome&&chrome.runtime.onMessage.addListener(function(s,a,n){return e(s,a,n),!0})}function handleResponse(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return}if(e.callbackId)return messageCallbacks.invoke(e.callbackId,e.data)}function onMessage(e,s,a){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}e.name?e.name.indexOf("re:")>-1?handleResponse(e):handleMessage(e,s,a):e.cmd?(e.name="toVault",handleMessage(e,s,a)):console.warn("Unhandled Message",e)}