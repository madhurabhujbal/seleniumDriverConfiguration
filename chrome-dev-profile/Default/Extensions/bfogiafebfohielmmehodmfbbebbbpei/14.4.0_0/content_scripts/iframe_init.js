!function(){function e(){addMessageListener(s),sendMessage("getLocationOfTopWindow",{type:"GET"},function(e){window.ourUrl=new URL(e),window.activityTimeout,window.lock_sanity={},window.overlay_sanity={left:"",top:""},document.addEventListener("mouseup",function(e){sendMessage("revertMovableHeader",{type:"ACTION"})}),window.overflowOverrideWhitelisted=[/www\.amtrak\.com\/home/i,/www\.hotels\.com/i].some(locationTester)})}function r(e){var r=getLanguage();if("ar_AE"===r||"iw_IL"===r?(e.style.direction="rtl",e.classList.add("keeper-rtl")):(e.style.direction="ltr",e.classList.remove("keeper-rtl")),overflowOverrideWhitelisted){let r=e.parentElement;for(;r&&r!==document.body;)r.style.overflow="visible",r=r.parentElement}}function t(e){r(e),e.message||e.parentElement.removeChild(e)}function a(e,t){r(e),e.refs.decline.addEventListener("click",function(e){sendMessage("clearPromptableLoginData",{type:"SET"}),sendMessage("transitionPopupOut",{type:"ACTION"})}),!t&&e.closeOnConfirm&&e.refs.confirm.addEventListener("click",function(r){var t=e.refs.recordSelector.record;t&&!t.can_edit?overlayAlert(translateThis("You do not have permission to edit this shared record"),e,{style:{paddingTop:"17.5px",marginTop:"20px"}}):sendMessage("closeFrame",{type:"ACTION"})})}function s(e,s,o){if(!e.params)if(safariAPI&&!o&&e.callbackId&&(o=function(r){r.callbackId=e.callbackId,sendMessage("requestResponse",{type:"ACTION",data:r})}),e.name&&e.name.indexOf("re:")>-1)handleResponse(e);else switch(e.name){case"MPReentry":var n=getOverlay(),i=e.data,d=i&&i.fromIframe,c=i&&i.closeWindow;n&&d&&(n.MPReentry&&n.MPReentry(),setTimeout(function(){c&&sendMessage("closeFrame",{type:"ACTION"})},50));break;case"syncCompleteActiveTab":onSyncCompleteActiveTab();break;case"showExtension":if(getOverlay())return;sendMessage("isLoggedIn",{type:"GET"},a=>{sendMessage("disable_tab",{type:"GET"},s=>{if(a)if(s)sendMessage("settings",{type:"GET"},t=>{if(t.disablePrompt){var a=e.data;a.header=translateThis("extension_prompt_to_disable_header"),a.message=translateThis("extension_prompt_to_disable");var s=createAndAssign("keeper-extension-simple-disabled",Object.assign({id:"keeper-extension"},a));addOverlayToFrame(s),function(e){r(e),e.message||e.parentElement.removeChild(e)}(s),o({action:"reposition"}),updateFrameHeight()}});else{var{isProactive:n,hints:i,lockId:d,groupType:c,referrer:l,recordGet:p,faviconUrl:g,inPageEmail:m}=e.data;y=showExtension(null,n,i,d,c,l,p,g,m);o({action:"reposition"}),safariAPI?updateFrameHeight(15):updateFrameHeight()}else{var f=e.data,y=createAndAssign("keeper-extension-simple",Object.assign({id:"keeper-extension"},f));addOverlayToFrame(y),t(y),o({action:"reposition"}),updateFrameHeight()}})});break;case"showPrompt":let{bgListener:s,onResponse:N}=e.data.props;const q=N||s?"keeper-extension-prompt":"keeper-extension-simple";var l=!1;if(getOverlayPrompt())return;if("undefined"!=typeof browser){switch(e.data.props.settingNameToToggle){case"changePrompt":e.data.props.onResponse=function(e){"confirm"===e.target.id&&sendMessage("changePasswordFlow",{type:"ACTION"})};break;case"savePrompt":e.data.props.onResponse=function(r){"confirm"===r.target.id&&sendMessage("showSaveOptions",{type:"ACTION",data:{promptableLoginData:e.data.props.promptableLoginData,existingRecord:e.data.props.existingRecord}})};break;case"fillPrompt":l=!0,e.data.props.onResponse=function(r){if("confirm"===r.target.id){var t=getOverlayPrompt&&getOverlayPrompt();t&&(t.closeOnConfirm=!1),sendMessage("updateNonSharedData",{type:"SET",data:{recordUid:e.data.props.firstRecord.record_uid,changes:{auto_fill_mode:"confirm"===r.target.id?"always":"never"}}},function(e){t.fill({payload:e,displayMode:"record"},!1)})}};break;case"reregistration":e.data.props.onResponse=function(r){"confirm"===r.target.id&&sendMessage("editMode",{type:"ACTION",data:{payload:e.data.props.payload,record:e.data.props.record}})}}e.data.props.bgListener=function(){}}else e.data.props.bgListener=o;if((n=createAndAssign(q,Object.assign({id:"keeper-extension"},e.data.props))).registrationRetry=!!(e&&e.data&&e.data.props)&&e.data.props.registrationRetry,addOverlayToFrame(n),"keeper-extension-simple"!=q&&afterAppendKeeperIconButtonFavicon(n.querySelector("keeper-favicon")),"keeper-extension-prompt"===q?a(n,l):"keeper-extension-simple"===q&&t(n),n.registrationRetry){var p=n.querySelector("keeper-checkbox-set");p&&(p.style.display="none")}e.data.fromPrompt=!0,sendMessage("repositionFrame",{type:"ACTION",data:e.data}),safariAPI?updateFrameHeight(15):updateFrameHeight();break;case"checkChangedPassword":var g=e.data,m=createAndAssign("keeper-extension-prompt",Object.assign({id:"keeper-extension"},g));addOverlayToFrame(m),a(m),afterAppendKeeperIconButtonFavicon(m.querySelector("keeper-favicon")),m.refs.record=g.record,m.refs.text.style.alignSelf="start",m.refs.recordSelector.style.display="none",m.refs.footer.style.display="none",m.checkChangePasswordSuccessView(),sendMessage("repositionFrame",{type:"ACTION",data:{forceToCenter:!0}}),safariAPI?updateFrameHeight(15):updateFrameHeight();break;case"showChangePrompt":let H=getOverlay();if(H.records&&1==H.records.length&&!H.records[0].can_edit)overlayAlert(translateThis("no_edit_permissions2"),H);else{var f=H.records.filter(e=>e.can_edit);f=f.filter(function(e){return!!(e&&e.secret2&&e.secret2.length&&e.secret2.length>0)});const{faviconUrl:e,referrer:r}=H,t=H.querySelector("keeper-record").record;if(f.length>0){sendMessage("toggleMoreIcon",{type:"ACTION",data:!1}),H.remove();g={records:f,message:translateThis("change_your_password"),settingNameToToggle:"changePrompt",closeOnConfirm:!1,onResponse(e){"confirm"===e.target.id&&sendMessage("changePasswordFlow",{type:"ACTION"})},faviconUrl:e,referrer:r};(_=createAndAssign("keeper-extension-prompt",Object.assign({id:"keeper-extension"},g))).querySelector("keeper-record").record=t,_.refs.disable&&(_.refs.disable.style.display="none"),addOverlayToFrame(_),a(_),afterAppendKeeperIconButtonFavicon(_.querySelector("keeper-favicon")),sendMessage("changePasswordReposition",{type:"ACTION"}),updateFrameHeight()}};break;case"showSaveOptions":var y=getOverlay(),{promptableLoginData:u,existingRecord:v}=e.data;y.showSaveOptions(v.title||u.title,function(){const e={record_uid:u.record_uid,title:y.refs.title.value,secret1:u.login,secret2:u.password,link:u.link};sendMessage("addRecord",{type:"SET",data:e},function(e){handleAddedRecord(e,"record"),y.showSavedRecord(e.record)})});break;case"settingChanged":var w=getOverlay(),{setting:h,value:k}=e.data;w&&h&&k&&(w[h]=k);break;case"backgroundError":let U=safariAPI?safari.extension.baseURI:chrome.extension.getURL("").slice(0,-1),j=e.data.data.map(e=>e.replace(new RegExp(U,"gi"),"")).join("\n  ------------------------------- \n");KeeperPromptManager.showPrompt({error:j});break;case"editMode":var O=(n=getOverlay()).querySelector("keeper-mode-selector")?n.querySelector("keeper-mode-selector").mode:"record",b=e&&e.data&&e.data.record?e.data.record:n.querySelector("keeper-record").record;function T(){"record"===O&&!0===(e.data||e.data.payload)&&b&&!b.can_edit?overlayAlert(translateThis("no_edit_permissions2"),n):(!0===e.data||function(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}(e.data)?n.editMode=e.data:n.editMode={registrationRecord:e.data&&e.data.record?e.data.record:e.data,registrationEditMode:!0},sendMessage("toggleHeaderButtons",{type:"ACTION",data:!0}))}sendMessage("masterPasswordReEntry",{type:"GET",data:{fromIframe:!0,closeWindow:!1,action:"record_level"}},function(e){e?T():(overlayAlert(null,n,null,null,!0),n.MPReentry=function(){T()})});break;case"showCreateEditScreen":var{itemType:A,edit:M}=e.data;(n=getOverlay()).displayMode=A;var P=n&&n.enforcements;if("record"===A&&P&&n.enforcements.restrictDomainCreate)overlayAlert(translateThis("role_enf_restriction"),n);else if(("card"===A||"address"===A)&&P&&n.enforcements.restrictCreateIdentityPaymentRecords)overlayAlert(translateThis("role_enf_restriction"),n);else{var C=n.querySelector("keeper-extension-no-record");C&&(C.style.display="none"),n.editMode||(M&&M.isEdit?(n.querySelector("keeper-record").record=M.data,n.editMode=!0):n.editMode={},sendMessage("toggleHeaderButtons",{type:"ACTION",data:!0}))}break;case"editDone":var E=(n=getOverlay()).querySelector("keeper-record"),I=n.querySelector("keeper-record-editor");I.changed?(I.save(),I.sanitize()):(I.save(),Object.keys(I.record).length?I.sanitize():E.restore(),n.editMode=!1,sendMessage("toggleHeaderButtons",{type:"ACTION",data:!1}));break;case"roleEnforcementRestriction":overlayAlert(translateThis("role_enf_restriction"),getOverlay());break;case"showMPRentryErrorPopup":overlayAlert(null,getOverlay(),null,null,!0);case"updateExtensionClasses":if((n=getOverlay())&&e.data){var{classesToAdd:F=[],classesToRemove:R=[]}=e.data;F.forEach(e=>n.classList.add(e)),R.forEach(e=>n.classList.remove(e))}break;case"changePasswordFlow":(_=getOverlay())&&_.showEditScreen();break;case"newPasswordFilled":var _;if(_=getOverlay()){var x=_.newPasswordFieldsFilled+1;_.newPasswordFieldsFilled=x,2==x&&_.savePasswordView()}break;case"oldPasswordFilled":{const e=getOverlay();e&&(e._previousMode="oldPasswordView",e.newPasswordView())}break;case"changePasswordFormSubmitted":{const e=getOverlayPrompt();e&&e.uploadRecord(function(r){e.checkChangePasswordSuccessView()})}break;case"closeRecordList":var S=document.querySelector("keeper-dropdown-toggle"),L=document.querySelector("keeper-record-chooser keeper-list");S&&L&&(S.opened=!1,L.remove());break;case"closeEditCreateMenuEventListener":;window.addEventListener("mouseup",function(e){window.removeEventListener("mouseup",this),sendMessage("closeEditCreateMenu",{type:"ACTION"})})}}window.inFrame=window.location!==window.parent.location,safariAPI?(window.supportsCrossOriginExtensionFrames=function(){const e=navigator.userAgent.match(/version\/(\d+(\.\d+)+)/i);if(e){const r=e[1].split(".")[0];return Number(r)>=13}return!1}(),window.supportsCrossOriginExtensionFrames&&location.href===safari.extension.baseURI+"content_scripts/prompt.html"?e():window.supportsCrossOriginExtensionFrames||window.inFrame||e()):e()}();