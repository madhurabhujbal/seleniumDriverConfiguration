var sso_token,sso_password,supportsClosingTabs=!0;function handleSSORequestResponse(e,t){switch(e.request){case"sso_login":handleSSOLoginFailure(e.response,t)}}function handleSSOLoginFailure(e,t){document.querySelector("img.bottom_space_header");document.querySelector(".container .progress").classList.add("hidden");var o=document.querySelector(".container .twofac");if(!o){(o=document.createElement("div")).className="twofac",o.style.width="200px";var n=document.createElement("label");n.for="two_factor_code",n.textContent="Please enter code.",n.className="bottom_space row two_factor_info",o.appendChild(n);var s=document.createElement("input");s.id="two_factor_code",s.placeholder="123456",s.className="bottom_space ie_text_input",o.appendChild(s);var a=document.createElement("label");a.className="ie_label bottom_space",o.appendChild(a);var r=document.createElement("input");r.id="two_factor_dont_ask",r.type="checkbox",a.appendChild(r),a.appendChild(document.createTextNode("Do not ask for 30 days."));var d=document.createElement("button");d.className="button primary",d.textContent="Login",o.appendChild(d),document.querySelector(".container").appendChild(o)}var c=document.querySelector(".container .error");if(!c){(c=document.createElement("div")).className="error hidden",o.classList.add("twofac");var i=document.createElement("div");i.className="error_text bottom_space",c.appendChild(i);var l=document.createElement("button");l.className="button primary",l.textContent="Open Vault",c.appendChild(l),document.querySelector(".container").appendChild(c)}if("invalid_device_token"==e.result_code||"need_totp"==e.result_code){if("two_factor_channel_duo"===e.channel){var u=document.getElementById("keeper-duo");if(!u){(u=document.createElement("div")).id="keeper-duo",o.prepend(u);var m=document.createElement("div");m.className="logo",u.appendChild(m);var p=document.createElement("div");p.className="message",p.textContent=translateThis("duo_instructions").replace("XXX",e.phone||""),u.appendChild(p);var _=document.createElement("div");_.className="duobuttons",u.appendChild(_);var f=e.capabilities||["push","sms","phone"];[["push","duo_push"],["sms","duo_text_message"],["phone","duo_voice_call"]].forEach(function(e){var t=e[0],o=e[1],n=document.createElement("button");n.id="duo-"+t,n.className="pretty",n.dataset.mode=t,n.textContent=translateThis(o),_.appendChild(n),f.indexOf(t)>-1?n.onclick=function(e){e.preventDefault(),this.disabled=!0,sendMessage("duoSelection",{type:"ACTION",data:{mode:t}},function(){})}:n.disabled=!0})}if(e.url){var v=new WebSocket(e.url);v.onopen=function(e){setTimeout(function(){v.close(4002,"client_timeout")},45e3)},v.onmessage=function(e){var t=JSON.parse(e.data);if(t.passcode){v.close(4e3,"successful_exchange");const e={result:sso_token.result,message:sso_token.message,email:sso_token.email,password:sso_token.password,token:t.passcode,tokenExpiry:g.value,provider_name:sso_token.provider_name,session_id:sso_token.session_id,command:sso_token.command};sendMessage("sso_login",{type:"ACTION",data:e})}else v.close(4001,"user_denied")},v.onclose=function(e){document.getElementById("duo-push").disabled=!0}}}var y=e.enforcements&&e.enforcements.two_factor_duration_web?e.enforcements.two_factor_duration_web.split(","):["0","30","9999"],g=document.createElement("select");if(g.style.fontSize="14px",document.querySelector(".container .twofac").replaceChild(g,document.querySelector(".container .twofac .ie_label")),-1!==y.indexOf("9999")){var h=document.createElement("option");h.value="9999",h.textContent="Save code on this device forever",g.appendChild(h)}if(-1!==y.indexOf("30")){var C=document.createElement("option");C.value="30",C.textContent="Require code every 30 days",g.appendChild(C)}if(-1!==y.indexOf("0")){var S=document.createElement("option");S.value="0",S.textContent="Require code every login",g.appendChild(S)}var b=document.getElementById("two_factor_code");b.type="password",b.oninput=function(){this.value=this.value.replace(/[^0-9]/g,"")};var w=document.createElement("div");w.id="eyeball",o.insertBefore(w,g),w.onclick=function(){this.classList.contains("visibility_off")?(b.type="password",this.classList.remove("visibility_off")):(b.type="",this.classList.add("visibility_off"))},document.querySelector(".container .twofac button.primary").onclick=function(){const e={result:sso_token.result,message:sso_token.message,email:sso_token.email,password:sso_token.password,token:document.querySelector("#two_factor_code").value,tokenExpiry:g.value,provider_name:sso_token.provider_name,session_id:sso_token.session_id,command:sso_token.command};sendMessage("sso_login",{type:"ACTION",data:e})},document.querySelector(".container .two_factor_info").textContent=e.message,document.querySelector(".container .twofac").classList.remove("hidden")}else if(t){var k=document.querySelector(".container .error button.primary"),x=k.cloneNode(!0);safariAPI&&!supportsClosingTabs?k.style.display="none":k.style.display="",k.textContent="Logout",k.id="logout",k.onclick=function(){sendMessage("closeTab",{type:"ACTION"}),safariAPI&&sendMessage("logout",{type:"ACTION"})},x.textContent="Accept",x.onclick=function(){sendMessage("openVault",{type:"ACTION"}),sendMessage("closeTab",{type:"ACTION"})},document.getElementById("error").insertBefore(x,k),document.querySelector(".container .error .error_text").textContent=e.message,document.querySelector(".container .twofac").classList.add("hidden"),document.querySelector(".container .error").classList.remove("hidden")}else{const t=document.querySelector(".container .error button.primary");safariAPI&&!supportsClosingTabs?t.style.display="none":t.style.display="",t.textContent="Close",t.onclick=function(){sendMessage("closeTab",{type:"ACTION"})},document.querySelector(".container .error .error_text").textContent=e.message,document.querySelector(".container .twofac").classList.add("hidden"),document.querySelector(".container .error").classList.remove("hidden")}safariAPI&&!supportsClosingTabs&&(document.querySelector(".container .error button.primary").display="none")}function addCustomStyles(){sendMessage("isSsoPage",{type:"GET"},function(e){if(!0===e){var t=document.querySelector(".container");if(t){t.id="keeper-sso";var o=document.createElement("div");o.classList.add("keeper-logo"),t.prepend(o);var n=document.querySelector(".container .progress");if(n){var s=document.createElement("div");s.id="waiting",s.textContent=translateThis("waiting"),n.append(s)}}}})}window.addEventListener("beforeunload",function(e){sendMessage("remove_do_not_prompt",{type:"ACTION"})}),safariAPI&&(addMessageListener(handleResponse),supportsClosingTabs=function(){const e=navigator.userAgent.match(/version\/(\d+(\.\d+)+)/i);if(e){const t=e[1].split("."),o=Number(t[0]),n=Number(t[1]);return o>12||12===o&&n>=1}return!1}()),window.addEventListener("message",function(e){if(e.data)switch(e.data.command){case"sso_login":const t={result:(sso_token=e.data).result,message:sso_token.message,email:sso_token.email,password:sso_token.password,command:sso_token.command,provider_name:sso_token.provider_name,session_id:sso_token.session_id};sendMessage("sso_login",{type:"ACTION",data:t})}}),addMessageListener(function(e){switch(e.name){case"requestResponse":e.data&&e.data&&e.data.response&&"auth_expired_transfer"==e.data.response.result_code&&"fail"==e.data.response.result?handleSSORequestResponse(e.data,!0):sendMessage("removeSSOInfoBeforeGoingToVault",{type:"ACTION"},function(){handleSSORequestResponse(e.data)})}}),"complete"===document.readyState||"interactive"===document.readyState?addCustomStyles():document.addEventListener("DOMContentLoaded",addCustomStyles);