var background,currentTab,searchTimeout,activityTimeout,ssoServiceProviders={},clientVersionHidden=!0,version="14.4.0",loginsAreHidden=!0,MPReEntry=!1,chromeApi="undefined"==typeof safari,safariApi=!chromeApi;function showMPReentryPasswordEntry(e){var t=document.getElementById("search"),o=document.getElementById("search-results"),n=document.getElementById("login"),r=document.querySelector("#login input[name=login]"),c=document.querySelector("#login .actions .remember.checkbox"),i=document.querySelector("#login .actions .remember.label"),s=document.querySelector("#login .start_sso"),a=document.querySelector("#login .account_upsell"),l=document.querySelector("#login #dropdown-button"),d=document.querySelector(".actions .login"),u=document.querySelector("#login form"),m=document.querySelector("#login .email-container"),h=document.getElementById("actionable-buttons"),g=document.querySelector("#login input[name=password]"),p=document.querySelector("#header .close");e&&(p.classList.add("hidden"),n.classList.remove("hidden"),t.classList.add("hidden"),o.classList.add("hidden")),r.classList.add("hidden"),c.classList.add("hidden"),i.classList.add("hidden"),s.classList.add("hidden"),a.classList.add("hidden"),l.classList.add("hidden"),m.classList.add("hidden");var S=document.createElement("span");S.innerText=translateThis("ChatAuthenticationRequired"),S.id="authenticationRequired",S.style.fontSize="14px",S.style.marginBottom="12px",S.style.display="block";var y=document.createElement("span");y.innerText=translateThis("admin_reauthenticate"),y.id="yourAdminRequires",y.style.fontSize="13px",y.style.marginBottom="16px",y.style.display="block";var f=document.createElement("div"),v=document.createElement("span"),b=document.createElement("span");v.classList.add("icon"),v.classList.add("material-icons"),v.classList.add("user-material-icons"),v.innerText="account_circle",v.style.verticalAlign="text-bottom",b.innerText=background.bg.get("uname"),b.style.verticalAlign="super",b.style.marginLeft="8px",f.style.marginBottom="16px",f.style.display="block",f.id="emailNameContainer",f.appendChild(v),f.appendChild(b),u.prepend(f),u.prepend(y),u.prepend(S),d.innerText=translateThis("Continue"),d.style.fontSize="14px",d.style.position="absolute",d.style.right="0px",d.style.marginRight="10px",d.style.marginTop="8px",h.style.paddingBottom="4px",u.onsubmit=function(h){h.preventDefault(),document.querySelector("#login form > .error").textContent="";var S=g.value;document.querySelector("#login input[name=totp]").value="";var y={command:"validate_master_password",pbkdf2Password:S};background.APIMPReentry(y).then(h=>{h.error?onLoginFail({result_code:"bad_inputs_username"}):(background.clearIntervalToolbarIcon(),background.bg.MPReEntryAction="",background.bg.masterPasswordReEntryCase=!1,background.bg.MPReentryEnabled=!1,e?(window.doMPEnforcedAction(),p.classList.remove("hidden"),n.classList.add("hidden"),r.classList.remove("hidden"),c.classList.remove("hidden"),i.classList.remove("hidden"),s.classList.remove("hidden"),a.classList.remove("hidden"),l.classList.remove("hidden"),m.classList.remove("hidden"),u.querySelector("#authenticationRequired").remove(),u.querySelector("#yourAdminRequires").remove(),u.querySelector("#emailNameContainer").remove(),d.innerText=translateThis("Login"),d.style.fontSize="12px",d.style.position="",d.style.right="",d.style.marginRight="",d.style.marginTop="",t.classList.remove("hidden"),o.classList.remove("hidden"),g.value=""):(background.doMPEnforcedAction(),window.close()))})}}function init(){if(background.getIsLoggedIn()&&showLoggedInScreen(),localStorage.savedUsers){var e=JSON.parse(localStorage.savedUsers);showSavedLogins(e),e&&Object.keys(e).length>0&&removeHidden(document.querySelector("#login #dropdown-button").classList)}else showSavedLogins({}),localStorage.savedUsers="{}";background.localSetting&&!background.localSetting.getItem("fromWhere")&&background.localSetting.setItem("fromWhere","slide");var t=localStorage.getItem("whichSide");if(t){var o=JSON.parse(t);Object.keys(o).forEach(function(e){o[e].includes("_")&&(o[e]=o[e].replace("_","-"))}),localStorage.setItem("whichSide",JSON.stringify(o))}background.localSetting&&!background.localSetting.getItem("whichSide")&&background.localSetting.setItem("whichSide","top-right"),fireIconClicked(),localize(),document.querySelector("#header .help").onclick=openHelp,document.querySelector("#header .search").onclick=showSearch,document.querySelector("#header .close").onclick=closeSettingsPane,document.querySelector("#login form").onsubmit=onLogin,document.querySelector("#login .start_sso").onclick=showSSO,document.querySelector("#login .account_upsell").onclick=openCreateAccount,document.querySelector("#login .actions button.upgrade").onclick=openCheckoutPage,document.querySelector("#login .actions button.vault").onclick=openVault,document.querySelector("#login select[name=expire_days]").onchange=on2FAExpireDaysChange,document.querySelector("#sso input").oninput=onSSOInput,document.querySelector("#sso input").onkeydown=onSSOKeydown,document.querySelector("#connectSSO").onclick=connectSSO,document.querySelector("#cancelSSO").onclick=cancelSSO,document.querySelector("#search input").oninput=searchInput,document.querySelector("#search input").onclick=unselectAll,document.querySelector("#login #dropdown-button").onclick=function(e){loginsAreHidden?showLogins():hideLogins()},document.querySelector("#settings .hoverlocks").onclick=showLockSettingsPane,document.querySelector("#settings .prompttologin").onclick=showLoginPromptSettingsPane,document.querySelector("#settings .changelocationprompt").onclick=showPromptLocationSettingsPane,document.querySelector("#settings .prompttodisable").onclick=showDisablePromptSettingsPane,document.querySelector("#settings .prompttofill").onclick=showFillPromptSettingsPane,document.querySelector("#settings .autosubmit").onclick=showAutoSubmitSettingsPane,document.querySelector("#settings .prompttosave").onclick=showSavePromptSettingsPane,document.querySelector("#settings .prompttochange").onclick=showChangePromptSettingsPane,document.querySelector("#settings .matchonsubdomain").onclick=showMatchOnSubdomainSettingsPane,document.querySelector("#settings .timer").onclick=showLogoutTimerSettingsPane,document.querySelector("#settings .themes").onclick=showThemeChooserSettingsPane,document.querySelector("#showlocks").onchange=settingToggleFactory("showLocks"),document.querySelector("#hoverlocks").onchange=settingToggleFactory("hoverLocks"),document.querySelector("#prompttologin").onchange=settingToggleFactory("loginPrompt"),document.querySelector("#prompttodisable").onchange=settingToggleFactory("disablePrompt"),document.querySelector("#prompttofill").onchange=settingToggleFactory("fillPrompt"),document.querySelector("#autosubmit").onchange=settingToggleFactory("autoSubmit"),document.querySelector("#prompttosave").onchange=settingToggleFactory("savePrompt"),document.querySelector("#prompttochange").onchange=settingToggleFactory("changePrompt"),document.querySelector("#matchonsubdomain").onchange=settingToggleFactory("matchOnSubdomain"),setupPromptAppearance(),document.querySelector(".keeperlogo").onclick=showHideClientVersion,document.querySelector("#login input[name=login]").onblur=function(){document.querySelector("#login .actions .remember.checkbox").classList.contains("checked")?localStorage.rememberedEmail=document.querySelector("#login input[name=login]").value:localStorage.rememberedEmail=""},document.querySelector("#restore-default").onclick=function(){var e=document.querySelector("#default-theme-color").classList[0];document.querySelector("#container").className=e,background.setTheme(e),document.querySelectorAll('.settings-pane input[type="checkbox"]').forEach(r),r(document.querySelector(".showlocks input"));var t=translateThis("top_right"),o=document.querySelector('#change-location-prompt-settings .choose-transition-effect input[data-value="slide"]');setActivePromptDisplayLocation({restoreDefault:t}),o&&setActivePromptDisplayFromWhere({restoreDefault:o});var n=document.querySelector("#change-location-prompt-settings .cs-skin-elastic");function r(e){"enablelogouttimer"===e.id?(background.setInactivityTimeout(0,!0),document.querySelector("#logouttime").value="",e.checked&&e.click()):"matchonsubdomain"===e.id?e.checked&&e.click():e.checked||e.click()}n&&(n.classList.remove("cs-active"),n.querySelector(".cs-placeholder").textContent=t),showSettings(),overlayAlert(translateThis("set_to_default"),"check")},document.querySelector("#menu .vault").onclick=openVault,document.querySelector("#menu .console").onclick=openConsole,document.querySelector("#menu .options").onclick=showSettings,document.querySelector("#menu .help").onclick=openHelp,document.querySelector("#menu .logout").onclick=onLogout,document.querySelector("#login .actions .remember.checkbox").onclick=function(){checkRememberMeCheckbox("check_box_outline_blank"===this.textContent)},document.querySelector("#login .actions .label").onclick=function(){checkRememberMeCheckbox("check_box_outline_blank"===document.querySelector("#login .actions .checkbox").textContent)},localStorage.rememberedEmail&&(document.querySelector("#login input[name=login]").value=localStorage.rememberedEmail,checkRememberMeCheckbox(!0),setTimeout(function(){document.querySelector("#login input[name=password]").focus()},200)),background.resetInactivityTimeout(!0),background.checkTermsAndPrivacyAccepted(function(e){e?background.getIsLoggedIn()?onLoginSuccess():(localStorage.removeItem("search"),localStorage.ssoServiceProvider&&showSSO(null,!0),fixHeight()):showTerms()}),document.querySelectorAll("#login #the-multi-login-dropdown .the-entries").forEach(function(e){e.addEventListener("pointerover",function(t){e.style.backgroundColor="#CAFFCA"}),e.addEventListener("pointerout",function(t){e.style.backgroundColor="#fff"})}),document.querySelectorAll("#login #the-multi-login-dropdown .actual-close-icon").forEach(function(e){e.addEventListener("mouseover",function(t){e.parentNode.parentNode.style.backgroundColor="#fff"})}),localStorage.ssoServiceProvider&&showSSO()}function onLogin(e){e.preventDefault(),document.querySelector("#login form > .error").textContent="";var t=document.querySelector("#login input[name=login]").value.trim();if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(t))return onLoginFail({result_code:"not_email"});var o=document.querySelector("#login input[name=password]").value,n=document.querySelector("#login input[name=totp]").value.replace(/\s+/g,"").trim(),r=getExpireDays(t);localStorage.removeItem("ssoServiceProvider"),document.querySelector("#login .actions .remember.checkbox").classList.contains("checked")?localStorage.rememberedEmail=document.querySelector("#login input[name=login]").value:localStorage.rememberedEmail="",document.querySelector("#login input[name=totp]").value="",doLogin(t,o,n,r)}function doLogin(e,t,o,n){fixHeight(),document.querySelector("#login input[name=password]").blur(),makeLoadingOverlay();var r=parseInt(n),c=Number.isNaN(r)||void 0==r?9999:r;background.bg.set("device_token_expire_days",c),c>0?background.bg.set("remember_device_token",!0):background.bg.set("remember_device_token",!1);window.navigator.userAgent.indexOf("Chrome")>-1&&navigator.vendor;var i=!!document.querySelector("#login .actions .remember.checkbox").classList&&document.querySelector("#login .actions .remember.checkbox").classList.contains("checked");function s(e){onLoginFail(e)}background.bg.set("logintype",background.protobuf.Authentication.LoginType.NORMAL),background.loginExtension({login:e,password:t,totp:o,offlineErrorCallback:s,rememberEmail:i,callback:function(o){"success"===o.result?(document.querySelector("#login input[name=password]").value="",onLoginSuccess(o)):"need_totp"===o.result_code&&o.u2f_challenge&&!background.isEdge?onU2FChallenge(o):"need_totp"===o.result_code||"invalid_device_token"===o.result_code?"invalid_device_token"===o.result_code?background.loginExtension({login:e,password:t,totp:"",offlineErrorCallback:s,rememberEmail:i,callback:function(e){onNeedTotp(e)}}):onNeedTotp(o):onLoginFail(Object.assign({},o,{login:e,password:t}))}})}function onLoginSuccess(e){var t;document.onmousemove=function(){clearTimeout(activityTimeout),activityTimeout=setTimeout(function(){background.resetInactivityTimeout(!0)},200)},removeLoadingOverlay(),setupPromptAppearance(),t=localStorage.savedUsers?JSON.parse(localStorage.savedUsers):{};var o=document.querySelector("#login .email-container input").value.trim(),n=document.querySelector("#login .actions .remember.checkbox");""!=o&&n.classList.contains("checked")&&(t[o]=o,localStorage.savedUsers=JSON.stringify(t),removeHidden(document.querySelector("#login #dropdown-button").classList)),showSavedLogins(t);const r=background.getSettings();background.bg.get("is_enterprise_admin")&&document.querySelector("#menu .console").classList.remove("hidden"),document.querySelector("#hoverlocks").checked=r.hoverLocks,document.querySelector("#prompttologin").checked=r.loginPrompt,document.querySelector("#prompttodisable").checked=r.disablePrompt,document.querySelector("#prompttofill").checked=r.fillPrompt,document.querySelector("#autosubmit").checked=r.autoSubmit,document.querySelector("#prompttosave").checked=r.savePrompt,document.querySelector("#prompttochange").checked=r.changePrompt,document.querySelector("#matchonsubdomain").checked=r.matchOnSubdomain;const c=background.bg.get("enforcements");if(c){const e={prompttofill:"restrict_prompt_to_fill",autosubmit:"restrict_auto_submit"};for(const t in e){if(c[e[t]]){var i=document.querySelector(`#${t}`);i.disabled=!0,i.parentElement.onclick=function(e){overlayAlert(translateThis("restrictedByAdmin"),null,2e3)}}}}document.querySelector("#header .help").classList.add("hidden"),document.querySelector("#header .search").classList.remove("hidden"),document.querySelector("#login").classList.add("hidden"),document.querySelector("#search-results").classList.remove("hidden"),localStorage&&(localStorage.search?(document.querySelector("#search input").value=localStorage.search,showSearch()):(showMenu(),setTimeout(function(){fixHeight()},200)),showLoggedInScreen())}function showLoggedInScreen(){document.querySelector("#container").className=background.getTheme();const e=background.getSettings();document.querySelector("#showlocks").checked=e.showLocks,document.querySelector("#header .help").classList.add("hidden"),document.querySelector("#header .search").classList.remove("hidden"),document.querySelector("#login").classList.add("hidden"),document.querySelector("#search-results").classList.remove("hidden"),localStorage&&(localStorage.search?(document.querySelector("#search input").value=localStorage.search,showSearch()):(showMenu(),setTimeout(function(){fixHeight()},200)))}function onNeedTotp(e){removeLoadingOverlay();var t=document.querySelector("#login input[name=login]").value.trim();if(document.querySelector("#login select[name=expire_days]").selectedIndex=background.localSetting.getItem("expire_index",t)||0,e.enforcements&&e.enforcements.two_factor_duration_web){var o=e.enforcements.two_factor_duration_web.split(","),n=document.querySelectorAll("select[name=expire_days] option");Array.prototype.forEach.call(n,function(e){-1===o.indexOf(e.value)&&e.remove()})}if(e.url){var r=new WebSocket(e.url);r.onopen=function(e){setTimeout(function(){r.close(4002,"client_timeout")},45e3)},r.onmessage=function(e){var o=JSON.parse(e.data);if(o.passcode){r.close(4e3,"successful_exchange");var n=document.querySelector("#login input[name=password]").value,c=getExpireDays(t);doLogin(t,n,o.passcode,c)}else r.close(4001,"user_denied")},r.onclose=function(e){"client_timeout"===e.reason||"user_denied"===e.reason?safariApi?safari.self.hide():window.close():(document.querySelector("#dna .logo").style.display="none",document.querySelector("#duo .duobuttons button[data-mode=push]").disabled=!0)}}var c=document.querySelector("#login input[name=totp]");switch(c.value="",setTimeout(function(){c.focus()},200),e.channel){case"two_factor_channel_push":document.querySelector("#dna .logo").style.backgroundImage="url(../images/dna/dna-animation.gif)",document.querySelector("#dna .message").textContent=e.prompt,document.querySelector("#dna").classList.remove("hidden"),c.placeholder=e.message,c.parentNode.classList.remove("hidden");break;case"two_factor_channel_duo":document.querySelector("#duo .logo").style.backgroundImage="url(../images/duo-logo.svg)",document.querySelector("#duo .message").textContent=translateThis("duo_instructions").replace("XXX",e.phone||"");var i=document.querySelectorAll("#duo button");e.capabilities?Array.prototype.forEach.call(i,function(t){e.capabilities.includes(t.id.replace("duo-",""))&&t.classList.remove("hidden"),this.disabled=!1,t.onclick=function(e){e.preventDefault();var t=e.target.getAttribute("data-mode");background.duoSelection(t,function(){}),this.disabled=!0}}):Array.prototype.forEach.call(i,function(e){e.classList.remove("hidden"),this.disabled=!1,e.onclick=function(e){e.preventDefault();var t=e.target.getAttribute("data-mode");background.duoSelection(t,function(){}),this.disabled=!0}}),c.placeholder=e.message,c.parentNode.classList.remove("hidden"),document.querySelector("#duo").classList.remove("hidden");break;default:c.parentNode.classList.remove("hidden")}fixHeight()}function on2FAExpireDaysChange(e){var t=document.querySelector("#login input[name=login]").value;e.target.selectedIndex>0?background.localSetting.setItem("expire_index",e.target.selectedIndex,t):background.localSetting.removeItem("expire_index",t)}function closeExtension(){safariApi?safari.self.hide():window.close()}function onU2FChallenge(e){background.bg.set("uname",document.querySelector("#login input[name=login]").value),background.bg.set("pass",document.querySelector("#login input[name=password]").value),background.bg.set("device_token_expire_days",0),background.bg.set("isPendingU2F",!0),background.bg.set("rememberMe","check_box"===document.querySelector("#login .actions .remember").textContent),chrome.tabs.query({url:background.DATA_VAULT_URL},function(e){e.length&&chrome.tabs.reload(e[0].id)}),openVault().then(function(e){background.bg.set("u2fTabId",e),closeExtension()},function(){closeExtension()})}function onLoginFail(e){switch(e.result_code||(e.result_code=e.error),removeLoadingOverlay(),e.result_code){case"auth_expired":case"auth_expired_transfer":case"password_rule_enforcement":case"two_factor_enforcement":var t=translateThis("need_vault_settings_update");document.querySelector("#login form > .error").textContent=e.message+"\n\n"+t,n();var o=document.querySelector("#login .actions button.vault");o.classList.remove("hidden"),o.onclick=function(t){background.bg.set("temp_login",e.login),background.bg.set("temp_password",e.password),openVaultNormal()};break;case"free_trial_expired":case"account_expired":document.querySelector("#login form > .error").textContent=e.message,n(),document.querySelector("#login .actions button.upgrade").classList.remove("hidden");break;case"user_does_not_exist":case"bad_inputs_username":document.querySelector("#login form > .error").textContent=translateThis("InvalidEmailOrPassword");break;case"not_email":document.querySelector("#login form > .error").textContent=translateThis("Email_not_valid");break;default:document.querySelector("#login form > .error").textContent=e.message}function n(){document.querySelector("#login form .email-container").classList.add("hidden"),document.querySelector("#login form input[name=password]").classList.add("hidden"),document.querySelector("#dna").classList.add("hidden"),document.querySelector("#duo").classList.add("hidden"),document.querySelector("#twofactorcode").classList.add("hidden"),document.querySelector("#login .actions .checkbox").classList.add("hidden"),document.querySelector("#login .actions .label").classList.add("hidden"),document.querySelector("#login .actions button.login").classList.add("hidden"),document.querySelector("#login .linkactions").classList.add("hidden")}fixHeight()}function onLogout(){background.Logout(),location.reload()}function makeLoadingOverlay(){var e=document.getElementById("loading_template"),t=document.importNode(e.content,!0);document.body.appendChild(t)}function removeLoadingOverlay(){var e=document.querySelector("#loading_overlay"),t=document.querySelector("#loading");e&&e.remove(),t&&t.remove()}function showSSO(e,t){document.querySelector("#login form").onsubmit=function(e){e.preventDefault()},document.querySelectorAll("#login .error").forEach(function(e){e.textContent=""}),document.querySelector("#sso input").style.borderBottom="1px solid gray",t&&(document.querySelector("#login form .email-container").classList.add("hidden"),document.querySelector("input[name=password]").classList.add("hidden")),t||(document.querySelector("#login form .email-container").classList.add("hidden"),document.querySelector("input[name=password]").classList.add("rollup")),document.querySelector(".actions").classList.add("hidden"),document.querySelector(".linkactions").classList.add("hidden"),localStorage.ssoServiceProvider?(document.querySelector("#sso input").value=localStorage.ssoServiceProvider,document.querySelector("#connectSSO").disabled=!1):document.querySelector("#sso input").value="",setTimeout(function(){document.querySelector("#sso input").focus()},200),document.querySelector("#sso").classList.remove("hidden"),setTimeout(function(){fixHeight()},250)}function onSSOInput(e){document.querySelector("#sso .error").textContent="",document.querySelector("#connectSSO").disabled=""===e.target.value}function onSSOKeydown(e){"Enter"===e.key&&connectSSO()}function connectSSO(){var e=document.querySelector("#sso input").value;document.querySelector("#connectSSO").disabled=!0,background.getSsoProvider(e,function(e){document.querySelector("#connectSSO").disabled=!1,"success"===e.result?(background.bg.set("sso_security_provider_url",e.sp_url),localStorage.ssoServiceProvider=e.name,openInNewTab(e.sp_url+"?embedded",!0).then(e=>{background.isEdge||(background.bg.doNotPrompt[e]=!0)})):(document.querySelector("#sso .error").textContent=e.message,localStorage.removeItem("ssoServiceProvider"),setTimeout(function(){document.querySelector("#sso input").focus()},200))})}function cancelSSO(){document.querySelector("#login form").onsubmit=onLogin,document.querySelector("#login form .email-container").classList.remove("rollup","hidden"),document.querySelector("input[name=password]").classList.remove("rollup","hidden"),document.querySelector(".actions").classList.remove("hidden"),document.querySelector(".linkactions").classList.remove("hidden"),document.querySelector("#sso").classList.add("hidden"),document.querySelector("#sso .error").textContent="",localStorage.removeItem("ssoServiceProvider"),setTimeout(function(){fixHeight()},250)}function showStringMatchedRecords(e){background.getStringMatchedRecords(e,function(e){if(document.querySelector("#search-results").classList.remove("hidden"),document.querySelector("#menu").classList.add("hidden"),e.length>0)showRecords(e);else{document.querySelector("#records").textContent="";var t=document.createElement("div");t.textContent=translateThis("RecordMatch.no"),t.className="no-results",document.querySelector("#records").appendChild(t)}})}function showUrlMatchedRecords(){try{var e=new URL(currentTab.url);""!==e.hostname?background.getUrlMatchedRecords(e.hostname,function(e){showRecords(e||[])}):showRecords([])}catch(e){showRecords([])}}function showFavoriteRecords(){clearSearch(),background.getFavoriteRecords(10,function(e){showRecords(e||[])})}function showRecentRecords(){clearSearch(),background.getRecentRecords(10,function(e){showRecords(e||[])})}function showSavedLogins(e){var t=document.querySelector("#the-multi-login-dropdown"),o=document.querySelector("#user_template");for(var n in e){var r=document.importNode(o.content,!0);r.querySelector(".username").id=n,r.querySelector(".username").addEventListener("click",function(e){document.querySelector("#login .email-container input").value=this.id,hideLogins()}),r.querySelector(".close-icon").addEventListener("click",function(e){this.parentNode.classList.add("hidden");var t=JSON.parse(localStorage.savedUsers);delete t[this.parentNode.querySelector(".username").id],localStorage.savedUsers=JSON.stringify(t),0==Object.keys(t).length&&(hideLogins(),addHidden(document.querySelector("#login #dropdown-button").classList))}),n.length>20&&(n=n.substring(0,20)+"..."),r.querySelector(".username").textContent=n,t.appendChild(r)}showSavedLoginAddButton()}function showSavedLoginAddButton(){var e=document.querySelector("#the-multi-login-dropdown"),t=document.getElementById("add-entry-template"),o=document.importNode(t.content,!0);o.querySelector("#add-entry").addEventListener("click",openVaultNormal),e.appendChild(o)}function showRecords(e){var t=document.querySelector("#records");t.textContent="";var o=document.querySelector("#record_template"),n=document.querySelector("#password_template"),r=document.querySelector("#field_template"),c=document.querySelector("#open_record_to_vault");e.forEach(function(e,i){var s=document.importNode(o.content,!0);localize(s);var a=background.bg.get("enforcements"),l=!1;a&&a.generated_password_complexity&&(l=background.enforcePrivacyScreen(a.generated_password_complexity,e));var d=s.querySelector(".record");d.id=e.record_uid,d.dataset.position=i,d.onmousemove=function(e){var t=function e(t,o){return t.classList&&t.classList.contains(o)?t:e(t.parentElement,o)}(e.target,"themable"),o=document.querySelector("#records .selected");t.classList.contains("selected")||t.classList.add("selected");o&&t!==o&&o.classList.remove("selected")},d.querySelector(".expand").onclick=function(e){d.querySelector(".more").classList.toggle("hidden"),this.textContent="expand_more"===this.textContent?"expand_less":"expand_more",fixHeight()},d.querySelector(".record-data").onclick=function(e){d.querySelector(".more").classList.toggle("hidden");var t=d.querySelector(".expand");t.textContent="expand_more"===t.textContent?"expand_less":"expand_more",fixHeight()},d.querySelector(".fill").onclick=function(){fillRecord(e)},d.querySelector(".title").textContent=e.title;var u=d.querySelector(".login");if(u.textContent=e.secret1||"",u.title=e.secret1||"",e.secret2){var m=document.importNode(n.content,!0);localize(m),e.owner||!1!==e.can_view||m.querySelector(".field").classList.add("noview"),m.querySelector(".field .name").textContent=translateThis("secret2_header"),m.querySelector(".field .value").textContent="••••••••••",m.querySelector(".field .value").hiddenPassword=e.secret2||"",l?m.querySelector(".show").classList.add("hidden"):m.querySelector(".show").onclick=function(){if((e.owner||!1!==e.can_view)&&!l){this.textContent="visibility"===this.textContent?"visibility_off":"visibility",this.setAttribute("tooltip","visibility"===this.textContent?translateThis("view_password"):translateThis("hide_password")),this.style.color=(this.textContent,"#eee");var t=this.parentNode.querySelector(".value");t.textContent="visibility"===this.textContent?"••••••••••":t.hiddenPassword}},s.querySelector(".more").appendChild(m)}var h=getURL(e.link);if(h){var g=document.importNode(r.content,!0);localize(g),g.querySelector(".field").classList.add("url"),g.querySelector(".field .name").textContent=translateThis("Login_Link"),g.querySelector(".field .value").textContent=urlComponentJoiner(h.href),g.querySelector(".field .value").onclick=function(){openInActiveTab(urlComponentJoiner(h.href,!0)||h.href)},s.querySelector(".more").appendChild(g)}function p(e,t,o,n){var r=document.importNode(maskable_content_field_template.content,!0);return r.querySelector(".field .name").textContent=e,r.querySelector(".show").style.color="#eee",r.querySelector(".field .value").textContent=(t||"").replace(/./g,"•"),r.querySelector(".show").textContent="visibility",r.querySelector(".show").setAttribute("tooltip",translateThis("view_contents")),o?r.querySelector(".show").onclick=function(){"visibility"===this.textContent?(this.textContent="visibility_off",this.setAttribute("tooltip",translateThis("hide_contents")),this.parentNode.querySelector(".value").textContent=t):"visibility_off"===this.textContent&&(this.textContent="visibility",this.setAttribute("tooltip",translateThis("view_contents")),this.parentNode.querySelector(".value").textContent=(t||"").replace(/./g,"•"))}:r.querySelector(".field").classList.add("noview"),r}if((e.extra&&e.extra.fields||[]).forEach(function(t){if("totp"===t.field_type){var o=new TotpField(t,e.can_view);s.querySelector(".more").appendChild(o.content)}}),e.custom&&a&&a.mask_custom_fields?e.custom.forEach(function(t){var o=p(t.name,t.value,e.can_view);s.querySelector(".more").appendChild(o)}):e.custom&&e.custom.forEach(function(t){var o=document.importNode(r.content,!0);/password/i.test(t.name)?o=p(t.name,t.value,e.can_view):(o.querySelector(".field .name").textContent=t.name,o.querySelector(".field .value").textContent=t.value),s.querySelector(".more").appendChild(o)}),e.notes&&a&&a.mask_notes){var S=p(translateThis("notes_header"),e.notes,e.can_view);s.querySelector(".more").appendChild(S)}else if(e.notes){(S=document.importNode(r.content,!0)).querySelector(".field .name").textContent=translateThis("notes_header"),S.querySelector(".field .value").textContent=e.notes,S.querySelector(".field .value").style.whiteSpace="pre-wrap",s.querySelector(".more").appendChild(S)}if(h){var y=document.importNode(c.content,!0);y.querySelector(".value").textContent=translateThis("ext_OpenInVault"),y.querySelector(".record-to-vault").onclick=function(){background.openVault(e),window.close()},s.querySelector(".more").appendChild(y)}var f=s.querySelectorAll(".copy");Array.prototype.forEach.call(f,function(t){!e.can_view||l&&t.parentElement.classList.contains("password")?t.style.display="none":t.onclick=function(e){e.stopPropagation(),enforceMPReentry("reveal",function(){var t=!1,o=e.target.parentNode.querySelector(".value"),n=document.createElement("input");o.hiddenPassword?n.value=o.hiddenPassword:n.value=o.textContent;document.body.appendChild(n),n.select(),t=document.execCommand("copy"),n.remove(),t&&overlayAlert(translateThis("DetailView.itemCopied"),"content_paste")})}}),t.appendChild(s)}),fixHeight()}function fillRecord(e){if(background.bg.MPReentryEnabled)enforceMPReentry("fill",function(){fillRecord(e)});else{var t=getDomain(e.link),o={payload:e,displayMode:"record"};if(t)t===getDomain(currentTab.url)?background.autoFill(o,currentTab.id):(background.bg.set("autoFillRecord",{record:e,filled:!1}),openInNewTab(e.link));else background.autoFill(o,currentTab);background.isFirefox||window.close()}}function showSearch(){document.querySelector("#search").classList.remove("collapsed"),document.querySelector("#search input").focus(),document.querySelector("#header .close").classList.remove("hidden"),document.querySelector("#header .close").onclick=hideSearch,document.querySelector("#header .search").classList.add("hidden");var e=document.querySelector("#search input").value;e?showStringMatchedRecords(e):fixHeight()}function clearSearch(){document.querySelector("#search input").value="",localStorage.removeItem("search")}function hideSearch(e){document.querySelector("#search").classList.add("collapsed"),document.querySelector("#header .close").classList.add("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane,document.querySelector("#header .search").classList.remove("hidden"),clearSearch(),!0!==e&&showMenu()}function searchInput(e){background.bg.get("isLoggedIn")&&(clearTimeout(searchTimeout),searchTimeout=setTimeout(function(){e.target.value?(localStorage.setItem("search",e.target.value),showStringMatchedRecords(e.target.value)):(localStorage.removeItem("search"),showMenu())},300))}function showMenu(){document.querySelector("#search-results").classList.add("hidden"),document.querySelector("#settings").classList.add("hidden"),document.querySelector("#menu").classList.remove("hidden"),fixHeight()}function showSettings(){hideSearch(!0),document.querySelector("#header .search").classList.add("hidden"),document.querySelector("#search-results").classList.add("hidden"),document.querySelector("#menu").classList.add("hidden"),document.querySelector("#header .close").classList.remove("hidden"),document.querySelector("#settings").classList.remove("hidden");var e=document.querySelectorAll("#settings .setting.prompttoggle"),t={hoverlocks:"hoverLocks",prompttologin:"loginPrompt",prompttodisable:"disablePrompt",prompttofill:"fillPrompt",autosubmit:"autoSubmit",prompttosave:"savePrompt",prompttochange:"changePrompt",matchonsubdomain:"matchOnSubdomain"};Array.prototype.forEach.call(e,function(e){var o=e.className.replace(/prompttoggle|setting|\s/gi,""),n=e.querySelector(".indicator"),r=t[o];!0===background.getSettings()[r]?(n.classList.remove("off"),n.classList.add("on")):(n.classList.remove("on"),n.classList.add("off"))}),fixHeight()}function closeSettingsPane(e){var t=document.querySelector(".settings-pane:not(.hidden)");t&&t.classList.add("hidden"),e?(document.querySelector("#header .close").classList.add("hidden"),document.querySelector("#header .search").classList.remove("hidden"),showMenu()):showSettings()}function settingToggleFactory(e){return function(t){background.updateSettings({[e]:t.target.checked})}}function showHideClientVersion(){var e=document.querySelector(".client-version-number");e.textContent=version,clientVersionHidden?(clientVersionHidden=!1,e.classList.remove("hidden")):(clientVersionHidden=!0,e.classList.add("hidden"))}function showLockSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#lock-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showLoginPromptSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#login-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showPromptLocationSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#change-location-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showDisablePromptSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#disable-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showFillPromptSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#fill-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showAutoSubmitSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#auto-submit-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showSavePromptSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#save-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showChangePromptSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#change-prompt-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showMatchOnSubdomainSettingsPane(){document.querySelector("#settings").classList.add("hidden"),document.querySelector("#match-on-subdomain-settings").classList.remove("hidden"),document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1),fixHeight()}function showThemeChooserSettingsPane(){document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1);var e=background.getTheme(),t=document.querySelectorAll("#themes .preview .row div");Array.prototype.forEach.call(t,function(t){t.onclick=function(t){t.target.className!==e&&(e=t.target.classList[0],document.querySelector("#container").className=e,background.setTheme(e))}}),document.querySelector("#settings").classList.add("hidden"),document.querySelector("#themes").classList.remove("hidden"),document.querySelector("#header .close").classList.remove("hidden"),document.querySelector("#header .search").classList.add("hidden"),fixHeight()}function setActivePromptDisplayLocation(e){var t=makeWhichSideLowercase(e.target&&e.target.innerText||e.restoreDefault);t&&(openCloseWhichSideDropdown(null,t),selectImageFromPromptAppearance(t,document.getElementById("containerforpromptlocation")),background.localSetting.setItem("whichSide",t))}function setActivePromptDisplayFromWhere(e){var t=e.target&&e.target.parentElement||e.restoreDefault.parentElement,o=t&&t.querySelector("input"),n=t&&t.querySelector("div"),r=o&&o.dataset&&o.dataset.value;n&&r&&(document.querySelectorAll("#header-for-checkbox-prompt-appearance .choose-transition-effect-checkbox-container input").forEach(e=>{e.parentElement.querySelector("div").classList.remove("active"),e.parentElement.querySelector("div").classList.add("inactive"),e.checked=!1}),n.classList.remove("inactive"),n.classList.add("active"),o&&(o.checked=!0),background.localSetting.setItem("fromWhere",r))}function toggleAppendToLock(e){var t=e.target&&e.target.parentElement,o=(t&&t.querySelector("input"),t&&t.querySelector("div")),n=document.querySelector("#header-for-checkbox-append-to-lock .choose-transition-effect-checkbox-container input");o&&n.checked?(n.parentElement.querySelector("div").classList.add("active"),n.parentElement.querySelector("div").classList.remove("inactive")):(n.parentElement.querySelector("div").classList.remove("active"),n.parentElement.querySelector("div").classList.add("inactive")),background.localSetting.setItem("appendRecordListToLock",n.checked)}function addDisableToCheckboxesBasedOnActiveWhichSide(e){switch(!0){case e.includes("top-left"):disableTheseDirections(["right","bottom"]),enableTheseDirections(["top","left"]);break;case e.includes("top-right"):disableTheseDirections(["left","bottom"]),enableTheseDirections(["top","right"]);break;case e.includes("bottom-left"):disableTheseDirections(["right","top"]),enableTheseDirections(["left","bottom"]);break;case e.includes("bottom-right"):disableTheseDirections(["left","top"]),enableTheseDirections(["right","bottom"]);break;case e.includes("top"):disableTheseDirections(["left","right","bottom"]),enableTheseDirections(["top"]);break;case e.includes("left"):disableTheseDirections(["top","right","bottom"]),enableTheseDirections(["left"]);break;case e.includes("right"):disableTheseDirections(["top","left","bottom"]),enableTheseDirections(["right"]);break;case e.includes("bottom"):disableTheseDirections(["top","left","right"]),enableTheseDirections(["bottom"]);break;case e.includes("middle"):disableTheseDirections(["top","left","right","bottom"])}}function enableTheseDirections(e){Array.isArray(e)&&e.forEach(e=>{var t=document.querySelector('#change-location-prompt-settings .choose-transition-effect input[data-value="'+e+'"]');t&&(t.disabled=!1)})}function disableTheseDirections(e){if(Array.isArray(e)){e.forEach(e=>{var t=document.querySelector('#change-location-prompt-settings .choose-transition-effect input[data-value="'+e+'"]');t&&(t.disabled=!0,t.checked&&(t.checked=!1))});var t=document.querySelector('#change-location-prompt-settings .choose-transition-effect input[data-value="none"]'),o=document.querySelector('#change-location-prompt-settings .choose-transition-effect input[data-value="fade"]');!t||o.checked||isAnySettingDirectionChecked()||(t.checked=!0,background.localSetting.setItem("fromWhere","none"))}}function isAnySettingDirectionChecked(){return Array.from(document.querySelectorAll("#change-location-prompt-settings .choose-transition-effect input")).some(e=>e.checked)}function showLogins(){if(localStorage.savedUsers){loginsAreHidden=!1;var e=JSON.parse(localStorage.savedUsers),t=Object.keys(e).length;switch(!0){case 0==t:addHidden(document.querySelector("#login #master-password").classList);break;case 1==t:addHidden(document.querySelector("#login #master-password").classList),addHidden(document.querySelector("#login #actionable-buttons .actions").classList);break;case t>=2:addHidden(document.querySelector("#login #master-password").classList),addHidden(document.querySelector("#login #actionable-buttons .actions").classList),addHidden(document.querySelector("#login #actionable-buttons .linkactions").classList)}removeHidden(document.querySelector("#login #the-multi-login-dropdown").classList),document.getElementById("header").addEventListener("click",function e(t){hideLogins();this.removeEventListener("click",e)})}}function hideLogins(){loginsAreHidden=!0,addHidden(document.querySelector("#login #the-multi-login-dropdown").classList),removeHidden(document.querySelector("#login #master-password").classList),removeHidden(document.querySelector("#login #actionable-buttons .actions").classList),removeHidden(document.querySelector("#login #actionable-buttons .linkactions").classList)}function showLogoutTimerSettingsPane(){document.querySelector("#header .close").onclick=closeSettingsPane.bind(null,!1);var e=background.getInactivityTimeout(),t=e/60,o=background.bg.get("enforcements")&&background.bg.get("enforcements.logout_timer_web");(o||e)&&(document.querySelector("#enablelogouttimer").checked=!0,document.querySelector("#logouttime").disabled=!1,document.querySelector("#timer button").disabled=!1,document.querySelector("#timer .content div:nth-child(2)").classList.remove("disabled-block"),document.querySelector("#logouttime").value=e%60==0?t.toFixed():t.toFixed(1)),document.querySelector("#enablelogouttimer").onchange=function(e){o?e.target.checked=!0:(e.target.checked?(background.setInactivityTimeout(1800,!0),document.querySelector("#logouttime").value="30"):(background.setInactivityTimeout(0,!0),document.querySelector("#logouttime").value=""),document.querySelector("#logouttime").disabled=!e.target.checked,document.querySelector("#timer button").disabled=!e.target.checked,document.querySelector("#timer .content div:nth-child(2)").classList.toggle("disabled-block",!e.target.checked))},document.querySelector("#timer form").onsubmit=function(e){e.preventDefault();var t=document.querySelector("#logouttime"),n=parseInt(t.value);if(o&&n>background.bg.get("enforcements.logout_timer_web"))return t.value=background.bg.get("enforcements.logout_timer_web"),void overlayAlert(translateThis("role_enf_restriction"),"warning",2e3);n<1?overlayAlert(translateThis("greater_than_zero"),"warning"):(background.setInactivityTimeout(60*n,!0),closeSettingsPane())},document.querySelector("#settings").classList.add("hidden"),document.querySelector("#timer").classList.remove("hidden"),document.querySelector("#header .close").classList.remove("hidden"),document.querySelector("#header .search").classList.add("hidden"),fixHeight()}function openHelp(){var e=background.getLanguage(),t="en_US"===e?"":"/"+e;openInNewTab("https://"+background.KEEPERSECURITY_HOST+t+"/user-guides/guide-browser-extensions.html")}function openVault(){var e=background.getLanguage(),t="en_US"===e?"":"#lang/"+e,o="en_US"===e?"#browserextensionlogin":"/#browserextensionlogin";return openInNewTab(background.DATA_VAULT_URL+t+o)}function openVaultNormal(){var e=background.getLanguage(),t="en_US"===e?"":"#lang/"+e;return openInNewTab(background.DATA_VAULT_URL+t)}function openConsole(){var e=background.getLanguage(),t="en_US"===e?"":"#lang/"+e;return openInNewTab(background.CONSOLE_URL+t)}function openCreateAccount(){var e=background.getLanguage(),t="en_US"===e?"":"/lang/"+e;openInNewTab(background.DATA_VAULT_URL+"#new"+t)}function openCheckoutPage(){var e=background.getLanguage(),t="en_US"===e?"":"/"+e,o=document.querySelector("#login form input[name=login]"),n=o&&o.value?"?email="+o.value:"";document.querySelector("#login form input[name=login]");openInNewTab("https://"+background.KEEPERSECURITY_HOST+t+"/checkout/"+n)}function openTerms(){var e=background.getLanguage(),t="en_US"===e?"":"/"+e;openInNewTab("https://"+background.KEEPERSECURITY_HOST+t+"/termsofuse.html")}function openPrivacyPolicy(){var e=background.getLanguage(),t="en_US"===e?"":"/"+e;openInNewTab("https://"+background.KEEPERSECURITY_HOST+t+"/privacypolicy.html")}function openInNewTab(e,t){var o=getURL(e);return new Promise(function(e,n){if(o)if(chromeApi)chrome.tabs.query({url:o.href.includes("#browserextensionlogin")?o.href.replace("#browserextensionlogin",""):o.href},function(r){if(r.length>0){var c=r[0];chrome.tabs.update(c.id,{active:!0}),chrome.windows.getCurrent(function(e){e.id!==c.windowId&&chrome.windows.update(c.windowId,{focused:!0})}),n(),window.close()}else background.isEdge&&(background.bg.doNotPrompt=!0),chrome.tabs.create({url:o.href},function(o){e(o.id),t||window.close()})});else{!1===safari.application.activeBrowserWindow.tabs.some(e=>{if(e.url===o.href)return e.activate(),!0})&&(safari.application.activeBrowserWindow.openTab().url=o.href),safari.self.hide(),n()}})}function openInActiveTab(e){var t=getURL(e);t&&(chromeApi?chrome.tabs.update(currentTab.id,{url:t.href}):currentTab.url=t.href)}function fixHeight(){safariApi&&(safari.self.height=document.querySelector("#container").offsetHeight)}function unselectAll(){var e=document.querySelector("#records .selected");e&&e.classList.remove("selected")}function overlayAlert(e,t,o){var n=document.createElement("div");n.className="material-icons icon",n.textContent=t;var r=document.createElement("div"),c=document.createElement("div");r.className="text",r.textContent=e,c.className=e.length>16?"overlayalert-big":"overlayalert",c.appendChild(n),c.appendChild(r),c.addEventListener("transitionend",function(){this.remove()}),document.body.appendChild(c),setTimeout(function(){c.classList.add("fade")},o||500)}function createAuthenticationErrorMessage(){var e=document.createElement("div"),t=document.createElement("div"),o=document.createElement("div"),n=document.createElement("span"),r=document.createElement("span");return e.style.margin="12px",e.style.display="flex",o.style.display="flex",o.style.flexDirection="column",o.style.marginLeft="4px",n.style.flexGrow="1",n.style.marginTop="4px",n.style.marginBottom="12px",n.style.fontSize="14px",r.style.lineHeight="20px",n.innerText=translateThis("ChatAuthenticationRequired"),r.innerText=translateThis("admin_reauthenticate"),t.id="overlay-info-image",o.appendChild(n),o.appendChild(r),e.appendChild(t),e.appendChild(o),e}function showTerms(){function e(e){var t=this.querySelector(".checkbox");t.textContent="check_box_outline_blank"===t.textContent?"check_box":"check_box_outline_blank","check_box"===document.querySelector("#terms .accept.terms .checkbox").textContent&&"check_box"===document.querySelector("#terms .accept.privacy .checkbox").textContent?document.querySelector("#terms button").disabled=!1:document.querySelector("#terms button").disabled=!0}document.querySelector("#terms .accept.terms label").onclick=e,document.querySelector("#terms .terms div").onclick=openTerms,document.querySelector("#terms .accept.privacy label").onclick=e,document.querySelector("#terms .privacy div").onclick=openPrivacyPolicy,document.querySelector("#terms .moreless").onclick=function(){var e=this.querySelector("span:first-child"),t=this.querySelector("span:last-child");e.textContent=e.textContent===translateThis("fastfill_more")?translateThis("fastfill_less"):translateThis("fastfill_more"),t.textContent="expand_more"===t.textContent?"expand_less":"expand_more",document.querySelector("#terms .blurb").classList.toggle("hidden"),fixHeight()},document.querySelector("#terms button").onclick=function(e){e.preventDefault(),background.setTermsAndPrivacyAccepted(),document.querySelector("#terms").classList.add("hidden"),document.querySelector("#login").classList.remove("hidden"),background.getIsLoggedIn()&&onLoginSuccess(),fixHeight()},document.querySelector("#login").classList.add("hidden"),document.querySelector("#search-results").classList.add("hidden"),document.querySelector("#settings").classList.add("hidden"),document.querySelector("#terms").classList.remove("hidden"),setTimeout(fixHeight,250)}function getURL(e){var t;if(e)try{t=new URL(e)}catch(o){0!==e.indexOf("http")&&(t=getURL("https://"+e.trim()))}return t}function getDomain(e){var t=getURL(e);if(t){var o=t.hostname.split(".");return"com"===o[o.length-1]||"net"===o[o.length-1]||"org"===o[o.length-1]?o.slice(-2).join("."):o.length<=2?t.hostname:o.slice(1).join(".")}return""}function checkRememberMeCheckbox(e){var t=document.querySelector("#login .actions .remember.checkbox"),o=document.querySelector("#login .actions .remember.label");e?(t.textContent="check_box",t.classList.add("checked"),o.classList.add("checked"),localStorage.rememberedEmail=document.querySelector("#login input[name=login]").value):(t.textContent="check_box_outline_blank",t.classList.remove("checked"),o.classList.remove("checked"),localStorage.rememberedEmail="")}function translateThis(e,t){var o=background.getLanguage();return translation[o]&&translation[o][e]?translation[o][e]:translation.en_US&&translation.en_US[e]?translation.en_US[e]:(console.warn("missing translation key:",e),t||e)}function localize(e){var t=background.getLanguage();e||("ar_AE"===t||"iw_IL"===t?document.body.classList.add("rtl"):document.body.classList.remove("rtl"),e=document);var o=e.querySelectorAll("[data-translation]");Array.prototype.forEach.call(o,function(e){var o=e.getAttribute("data-translation"),n=translation[t][o];n?e.placeholder?e.placeholder=n:e.getAttribute("tooltip")?e.setAttribute("tooltip",n):e.textContent=n:console.warn("missing translation key:",o)})}function toggleActive(e){}function addHidden(e){e.contains("hidden")||e.add("hidden")}function removeHidden(e){e.contains("hidden")&&e.remove("hidden")}function fireIconClicked(){background.handleIconClicked()}function urlComponentJoiner(e,t){try{var{protocol:o,host:n,pathname:r,search:c}=new URL(e)}catch(t){return e}if(o+="//",/[!@#$%^&*(),?":{}|<>]/i.test(n)&&(n=unescape(n)),/[!@#$%^&*(),?":{}|<>]/i.test(n)){var i=[];n.split(".").forEach(e=>{/[!@#$%^&*(),?":{}|<>]/i.test(e)||i.push(e)}),n=i.join(".")}return[o,n.replace(/^www\./,""),r,c].slice(1,t?4:2).join("")}function makeWhichSideUppercase(e){switch(e){case"top-right":return translateThis("top_right");case"top-left":return translateThis("top_left");case"bottom-right":return translateThis("bottom_right");case"bottom-left":return translateThis("bottom_left");default:return""}}function makeWhichSideLowercase(e){switch(e){case translateThis("top_right"):return"top-right";case translateThis("top_left"):return"top-left";case translateThis("bottom_right"):return"bottom-right";case translateThis("bottom_left"):return"bottom-left";default:return""}}function openCloseWhichSideDropdown(e,t){var o=document.querySelector(".cs-placeholder");o.parentElement.classList.contains("cs-active")?(t||(t=background.localSetting.getItem("whichSide")),t&&(o.innerText=makeWhichSideUppercase(t)),o.parentElement.classList.remove("cs-active")):(o.innerText="Select a Location",o.parentElement.classList.add("cs-active"))}function selectImageFromPromptAppearance(e,t){if(t.classList){if(t.classList.contains(e))return;t.classList.forEach(e=>{(e.includes("top")||e.includes("bottom"))&&t.classList.remove(e)}),e&&t.classList.add(e)}}function setupPromptAppearance(){var e=background.localSetting&&background.localSetting.getItem("whichSide")?background.localSetting.getItem("whichSide"):"top-right";document.querySelector(".cs-placeholder").innerText=makeWhichSideUppercase(e),selectImageFromPromptAppearance(e,document.getElementById("containerforpromptlocation")),document.querySelector(".cs-placeholder").onclick=openCloseWhichSideDropdown,document.querySelectorAll(".cs-selected").forEach(e=>{e.onclick=setActivePromptDisplayLocation});var t=background.localSetting.getItem("fromWhere")?background.localSetting.getItem("fromWhere"):"slide";document.querySelectorAll("#header-for-checkbox-prompt-appearance .choose-transition-effect .choose-transition-effect-checkbox-container").forEach(e=>{var o=e.querySelector("input");t&&o.dataset&&o.dataset.value===t&&(document.querySelector(".choose-transition-effect .active").classList.add("inactive"),document.querySelector(".choose-transition-effect .active").classList.remove("active"),e.querySelector("div").classList.remove("inactive"),e.querySelector("div").classList.add("active"),o.checked=!0),e.onclick=setActivePromptDisplayFromWhere})}function enforceMPReentry(e,t){var o=background.bg.get("enforcements");if(o&&o.master_password_reentry&&(o.master_password_reentry.operations.find(t=>t==e)&&(background.resetMPReentryTimeout(),background.bg.MPReentryEnabled)))return showMPReentryPasswordEntry(!0),void(window.doMPEnforcedAction=function(){t()});t()}function start(e){if(chromeApi){if((background=chrome.extension.getBackgroundPage()).clearIntervalToolbarIcon||setTimeout(function(){background.clearIntervalToolbarIcon()},10),!background.getLanguage)return void setTimeout(function(){start(e)},10);chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(e){currentTab=e[0],background.bg.masterPasswordReEntryCase?(MPReEntry=!0,showMPReentryPasswordEntry()):init()}),chrome.tabs.onUpdated.addListener(function(e,t,o){currentTab&&currentTab.id===e&&(currentTab=o)})}else background=safari.extension.globalPage.contentWindow,currentTab=safari.application.activeBrowserWindow.activeTab,init()}function getExpireDays(e){var t=background.localSetting.getItem("expire_index",e);if(!t)return document.querySelector("#login select[name=expire_days]").value;switch(t){case 0:return 0;case 1:return 30;case 2:return 9999}}"undefined"!=typeof browser&&(chrome=browser),document.addEventListener("keydown",function(e){document.getElementById("menu").classList.contains("hidden")||showSearch()}),document.addEventListener("DOMContentLoaded",start),document.addEventListener("keydown",function(e){var t=document.getElementById("container"),o=document.getElementById("header"),n=document.getElementById("search-results"),r=document.getElementById("records"),c=document.querySelector("#search input");if(n.classList&&!n.classList.contains("hidden")&&r.children.length>0)if(["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"].includes(e.key)){var i=(a=document.querySelector("#records .selected"))&&parseInt(a.dataset.position);switch(e.key){case"ArrowUp":if(c.blur(),a)if(0===i)r.children[r.children.length-1].classList.add("selected"),r.children[0].classList.remove("selected"),r.children[r.children.length-1].scrollIntoView(!1);else{(s=r.children[i-1]).classList.add("selected"),a.classList.remove("selected"),s.getBoundingClientRect().top<=o.getBoundingClientRect().bottom&&s.scrollIntoView(!0)}else r.children[0].classList.add("selected"),r.children[0].scrollIntoView(!0);break;case"ArrowDown":if(c.blur(),a)if(i===r.children.length-1)r.children[0].classList.add("selected"),r.children[r.children.length-1].classList.remove("selected"),r.children[0].scrollIntoView(!0);else{var s;(s=r.children[i+1]).classList.add("selected"),a.classList.remove("selected"),s.getBoundingClientRect().bottom>=t.getBoundingClientRect().bottom&&s.scrollIntoView(!1)}else r.children[0].classList.add("selected"),r.children[0].scrollIntoView(!0);break;case"ArrowRight":a.querySelector(".expand").click()}}else if("Enter"===e.key){var a=document.querySelector("#records .selected");fillRecord(background.getRecordById(a.id))}else document.querySelector("#search input").focus()});var TotpSpinner=function(e,t){this.radius=e||12,this.strokeWidth=t||4;const o=2*e,n=`0 0 ${o} ${o}`,r=`translate(${e}, ${e})`,c=e-t/2;this.renderCircumference=2*Math.PI*c;const i="http://www.w3.org/2000/svg";this.svg=document.createElementNS(i,"svg"),this.svg.setAttribute("viewBox",n),this.svg.setAttribute("class","countdown-circle"),this.svg.setAttribute("height",o+"px"),this.svg.setAttribute("width",o+"px");const s=document.createElementNS(i,"g");s.setAttribute("transform",r),this.svg.appendChild(s),baseCircle=document.createElementNS(i,"circle"),baseCircle.setAttribute("class","base"),baseCircle.setAttribute("r",c),s.appendChild(baseCircle),this.progressCircle=document.createElementNS(i,"circle"),this.progressCircle.setAttribute("class","progress"),this.progressCircle.setAttribute("r",c),this.progressCircle.setAttribute("transform","rotate(-90)"),this.progressCircle.style.strokeDashoffset=0,this.progressCircle.style.strokeDasharray=this.renderCircumference,s.appendChild(this.progressCircle)};TotpSpinner.prototype.update=function(e){const t=this.renderCircumference+this.renderCircumference*e/this.duration;this.offset=t,this.progressCircle.style.strokeDashoffset=this.offset},TotpSpinner.prototype.startTimer=function(e,t,o){this.offset=e,this.duration=t,this.update(this.duration);let n=this.duration;this.intervalTimer=window.setInterval(()=>{--n<=0&&(o&&o(),n=this.duration),this.update(n)},1e3);const r=this,c=new MutationObserver(function(e){e.forEach(function(e){var t=Array.from(e.removedNodes),o=t.indexOf(r)>-1,n=t.some(e=>e.contains(r.svg));(o||n)&&(r.clearTimer(),c.disconnect())})});c.observe(document.body,{subtree:!0,childList:!0})},TotpSpinner.prototype.clearTimer=function(){window.clearInterval(this.intervalTimer),this.update(this.duration)};var TotpField=function(e,t){this.content=document.importNode(totp_template.content,!0);const o=e.data;if(this.params=generateTotpParams(o),this.token=background.generateTotpToken(this.params),this.isShowing=!1,this.content.querySelector(".field .name").textContent=translateThis("two_factor_code")||"",this.content.querySelector(".show").style.color="#eee",this.fieldValue=this.content.querySelector(".field .value"),this.fieldValue.textContent=this.formatToken((this.token||"").replace(/./g,"•")),this.setValue(this.token),this.eyeball=this.content.querySelector(".show"),this.eyeball.textContent="visibility",this.eyeball.setAttribute("tooltip",translateThis("view_contents")),t){const e=this.eyeball;e.onclick=(()=>{var t=this;enforceMPReentry("reveal",function(){t.isShowing="visibility"===e.textContent,e.textContent=t.isShowing?"visibility_off":"visibility",e.setAttribute("tooltip",translateThis(t.isShowing?"hide_contents":"view_contents")),t.fieldValue.textContent=t.isShowing?t.formatToken(t.token,!0):t.formatToken(t.token||"").replace(/./g,"•")})})}else this.content.querySelector(".field").classList.add("noview");var n=new TotpSpinner(15,4);const r=this.content.querySelector(".field div:first-child");this.content.firstElementChild.insertBefore(n.svg,r),n.svg.style.flexShrink="0",n.svg.style.padding="5px 15px 0 0",n.svg.style.boxSizing="content-box";var c=this.params.period||60;n.startTimer(0,c,()=>{this.token=background.generateTotpToken(this.params),this.setValue(this.token)})};function generateTotpParams(e,t){const o=parseTotpUri(e);if(o||t){const{secret:e="",algorithm:t="SHA1",period:n=30,digits:r=6}=o;return{key:e,algorithm:t,period:n,digits:r}}}function parseTotpUri(e){const t=/otpauth:\/\/totp\/(?:(.+):)?(.*)\?(.*)/i.exec(e);if(t){const e=t[1],o=t[2],n=t[3],r=e?decodeURIComponent(e):null;return n.split("&").reduce((e,t)=>{const[o,n]=t.split("="),r=o.toLowerCase();return e[r]="issuer"===r?decodeURIComponent(n):"period"===r||"digits"===r?parseInt(n):n,e},{accountName:o,issuer:r})}}TotpField.prototype.formatToken=function(e,t){if(!e||0===e.length)return e;e=e.split("");const o=Math.ceil(e.length/2);return t&&e.splice(o,0," "),e=e.join("")},TotpField.prototype.setValue=function(e){this.token=e;var t=this.fieldValue;t&&(t.hiddenPassword=this.token.replace(/\s+/g,"")),this.isShowing&&(this.fieldValue.textContent=this.formatToken(this.token||"",!0))};